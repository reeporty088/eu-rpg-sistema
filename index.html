<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ficha RPG - Alta Fantasia</title>
    <style>
        :root { --bg: #121212; --card-bg: #41141a; --header-bg: #800000; --text: #ffffff; }
        body { background: #1a1a1a; color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; padding: 20px; }
        .container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; max-width: 1300px; }
        .card { background: var(--card-bg); border-radius: 12px; padding: 15px; border: 1px solid #5a1a1f; }
        .header-label { background: var(--header-bg); text-align: center; border-radius: 20px; padding: 5px; margin-bottom: 15px; font-weight: bold; }
        input, textarea { background: #2a0a0d; border: 1px solid #555; color: white; padding: 5px; border-radius: 5px; width: 100%; box-sizing: border-box; }
        .attr-box { background: #2a0a0d; border: 1px solid #7a2a2f; border-radius: 15px; padding: 10px; text-align: center; }
        .pericia-row { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); margin-bottom: 4px; padding: 5px; border-radius: 8px; }
        .pericia-row input { width: 50px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="col">
        <div class="card">
            <div class="header-label">Geral</div>
            <label>Idade:</label><input type="text" id="idade">
            <label>Florins:</label><input type="text" id="florins">
            <label>Arquétipo:</label><input type="text" id="arquetipo">
            
            <div class="header-label" style="margin-top:20px;">Atributos</div>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px;">
                <div class="attr-box"><input type="number" id="poder" value="0"><div>PODER</div></div>
                <div class="attr-box"><input type="number" id="habilidade" value="0"><div>HABILIDADE</div></div>
                <div class="attr-box"><input type="number" id="resistencia" value="0"><div>RESISTÊNCIA</div></div>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <div class="header-label">Perícias</div>
            <div class="pericia-row"><span>ANIMAIS</span><input type="number" id="p_animais" value="0"></div>
            <div class="pericia-row"><span>ARTE</span><input type="number" id="p_arte" value="0"></div>
            <div class="pericia-row"><span>LUTA</span><input type="number" id="p_luta" value="0"></div>
            <div class="pericia-row"><span>MÍSTICA</span><input type="number" id="p_mistica" value="0"></div>
            </div>
    </div>

    <div class="col">
        <div class="card">
            <div class="header-label">Vantagens / Técnicas</div>
            <textarea id="vantagens" style="height: 150px;" placeholder="Descreva aqui..."></textarea>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, update, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCvxxwfsonP5a45nbcz34cxYhXaWBZVhwQ",
        authDomain: "ed-rpg---sistema-de-fichas.firebaseapp.com",
        databaseURL: "https://ed-rpg---sistema-de-fichas-default-rtdb.firebaseio.com",
        projectId: "ed-rpg---sistema-de-fichas",
        storageBucket: "ed-rpg---sistema-de-fichas.firebasestorage.app",
        messagingSenderId: "350999444010",
        appId: "1:350999444010:web:d89f31d13e449b8fbfa153"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const fichaID = "personagem_1";

    // 1. SALVAR (Quando o usuário termina de digitar)
    document.addEventListener('change', (e) => {
        if (e.target.id) {
            update(ref(db, 'fichas/' + fichaID), {
                [e.target.id]: e.target.value
            });
        }
    });

    // 2. CARREGAR (Busca os dados assim que abre o site)
    onValue(ref(db, 'fichas/' + fichaID), (snapshot) => {
        const dados = snapshot.val();
        if (dados) {
            Object.keys(dados).forEach(idDoCampo => {
                const elemento = document.getElementById(idDoCampo);
                // Só atualiza se o usuário não estiver digitando naquele campo agora
                if (elemento && document.activeElement !== elemento) {
                    elemento.value = dados[idDoCampo];
                }
            });
        }
    });
</script>

</body>
</html>
