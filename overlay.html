<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay RPG</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Roboto:wght@900&display=swap');

        body { 
            margin: 0; 
            overflow: hidden; 
            background: transparent; /* Fundo transparente para o OBS */
            font-family: 'Cinzel', serif;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        /* Container Principal */
        .overlay-container {
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s, transform 0.5s;
        }
        .overlay-container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Estilo do Texto Neon */
        .neon-text {
            color: #ffffff; /* Texto sempre branco */
            font-weight: 900;
            text-transform: uppercase;
            /* O text-shadow será injetado via JS baseado na cor do tema */
        }

        /* --- MODO STATUS (Barras e Números) --- */
        .status-wrapper {
            display: flex;
            gap: 40px;
            align-items: flex-end;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .stat-value {
            font-size: 56px; /* Números bem grandes */
            line-height: 1;
            font-family: 'Roboto', sans-serif; /* Fonte mais grossa para números */
        }

        .stat-label {
            font-size: 18px;
            margin-top: 5px;
            letter-spacing: 2px;
            opacity: 0.9;
        }

        /* Ícones opcionais (pode remover se quiser só texto) */
        .icon { font-size: 24px; margin-bottom: 5px; display: block; }

        /* --- MODO NOME --- */
        .char-name {
            font-size: 72px;
            letter-spacing: 3px;
            white-space: nowrap;
        }

    </style>
</head>
<body>

    <div id="app" class="overlay-container">
        </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCvxxwfsonP5a45nbcz34cxYhXaWBZVhwQ",
        authDomain: "ed-rpg---sistema-de-fichas.firebaseapp.com",
        databaseURL: "https://ed-rpg---sistema-de-fichas-default-rtdb.firebaseio.com",
        projectId: "ed-rpg---sistema-de-fichas",
        storageBucket: "ed-rpg---sistema-de-fichas.firebasestorage.app",
        messagingSenderId: "350999444010",
        appId: "1:350999444010:web:d89f31d13e449b8fbfa153"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Pega o ID da URL (ex: overlay.html?p=guerreiro)
    const urlParams = new URLSearchParams(window.location.search);
    const fichaID = urlParams.get('p');

    // Mapa de Cores (Copiado do index.html)
    // Se quiser o brilho mais forte, pode clarear essas cores hexadecimais
    const themeColors = { 
        sangue: '#ff0000',    // Vermelho vivo
        oceano: '#0088ff',    // Azul claro
        floresta: '#00ff00',  // Verde neon
        ametista: '#d500f9',  // Roxo brilhante
        brasa: '#ff4400',     // Laranja fogo
        sombra: '#aaaaaa',    // Cinza claro (para brilhar no fundo escuro)
        ouro: '#ffcc00',      // Amarelo ouro
        rosa: '#ff00cc'       // Rosa choque
    };

    if (!fichaID) {
        document.body.innerHTML = "<h1 style='color:white'>ERRO: ID não especificado na URL (?p=...)</h1>";
    } else {
        onValue(ref(db, 'fichas/' + fichaID), (snapshot) => {
            const data = snapshot.val();
            if (data) updateOverlay(data);
        });
    }

    function updateOverlay(data) {
        const container = document.getElementById('app');
        const mode = data.overlay_mode || 'status'; // 'status' ou 'nome'
        const theme = data.color_theme || 'sangue';
        
        // Pega a cor base. Se não achar, usa vermelho padrão.
        const glowColor = themeColors[theme] || '#ff0000';

        // Cria o estilo de brilho (Glow)
        // 3 camadas de sombra para criar um efeito de névoa/neon forte
        const glowStyle = `text-shadow: 
            0 0 10px ${glowColor}, 
            0 0 20px ${glowColor}, 
            0 0 40px ${glowColor};`;

        let html = '';

        if (mode === 'nome') {
            // MODO: APENAS NOME
            html = `
                <div class="neon-text char-name" style="${glowStyle}">
                    ${data.char_name || 'Desconhecido'}
                </div>
            `;
        } else {
            // MODO: STATUS (Vida, Mana, PA)
            // Se Máscara Lunar estiver ativa, muda a cor do brilho para Ciano
            // Se Inferno estiver ativo, muda para Vermelho Sangue
            let finalGlow = glowStyle;
            if (data.active_abilities?.mask) {
                const maskColor = '#00ffff';
                finalGlow = `text-shadow: 0 0 10px ${maskColor}, 0 0 20px ${maskColor}, 0 0 40px ${maskColor};`;
            } else if (data.active_abilities?.hell) {
                const hellColor = '#ff0000';
                finalGlow = `text-shadow: 0 0 10px ${hellColor}, 0 0 20px ${hellColor}, 0 0 40px ${hellColor};`;
            }

            // Valores Atuais
            const hp = data.hp_at || 0;
            const mp = data.mp_at || 0;
            const pa = data.pa_at || 0;

            html = `
                <div class="status-wrapper">
                    <div class="stat-item">
                        <span class="neon-text stat-value" style="${finalGlow}">${hp}</span>
                        <span class="neon-text stat-label" style="${finalGlow}">VIDA</span>
                    </div>
                    <div class="stat-item">
                        <span class="neon-text stat-value" style="${finalGlow}">${mp}</span>
                        <span class="neon-text stat-label" style="${finalGlow}">MANA</span>
                    </div>
                    <div class="stat-item">
                        <span class="neon-text stat-value" style="${finalGlow}">${pa}</span>
                        <span class="neon-text stat-label" style="${finalGlow}">AÇÃO</span>
                    </div>
                </div>
            `;
        }

        container.innerHTML = html;
        container.classList.add('visible');
    }
</script>
</body>
</html>
